<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Manajemen Mahasiswa</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ======================================================
   MODE TERANG / GELAP
====================================================== */
:root {
    --bg: #f4f4f4;
    --text: #222;
    --card: #ffffff;
    --primary: #4a6cf7;
    --border: #d8d8d8;
    --sidebar-bg: #ffffff;
    --accent: #4a6cf7;
}

body.dark {
    --bg: #121212;
    --text: #fff;
    --card: #1e1e1e;
    --primary: #6b8cff;
    --border: #444;
    --sidebar-bg: #1a1a1a;
}

body {
    font-family: Arial;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    transition: 0.3s;
}

/* PRELOADER */
#preloader {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}
.loader {
    border: 6px solid var(--border);
    border-top: 6px solid var(--primary);
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s infinite linear;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* SIDEBAR */
.sidebar {
    width: 240px;
    background: var(--sidebar-bg);
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    transition: 0.3s ease;
    padding-top: 20px;
    z-index: 2500;
}

.sidebar.hide {
    transform: translateX(-300px);
}

.sidebar h2 {
    text-align: center;
    margin-bottom: 30px;
}

.sidebar a {
    display: block;
    padding: 14px 25px;
    color: var(--text);
    text-decoration: none;
    transition: 0.25s;
}

.sidebar a:hover {
    background: var(--primary);
    color: white;
    padding-left: 35px;
}

/* TOGGLE BUTTON */
#toggleSidebar {
    position: fixed;
    top: 15px;
    left: 15px;
    background: var(--accent);
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    z-index: 3000;
    cursor: pointer;
    transition: 0.25s;
}

/* CONTENT */
.main {
    margin-left: 260px;
    padding: 20px;
    transition: 0.3s;
}

.main.collapsed {
    margin-left: 50px;
}

/* CARDS */
.dashboard {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.card {
    background: var(--card);
    padding: 20px;
    flex: 1;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 0.6s forwards;
}

@keyframes fadeUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

input, button, select {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text);
    margin: 5px 0;
}

button {
    background: var(--primary);
    color: #fff;
    border: none;
    cursor: pointer;
}

button:hover { opacity: 0.8; }

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid var(--border);
    padding: 10px;
}

/* LOGIN */
#loginSection {
    margin: auto;
    margin-top: 100px;
    padding: 40px;
    width: 350px;
    background: var(--card);
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.hidden { display: none; }

#modeToggle {
    float: right;
    background: var(--primary);
    color: white;
    padding: 7px 20px;
    border-radius: 6px;
}
</style>
</head>
<body>

<!-- LOADING -->
<div id="preloader"><div class="loader"></div></div>
<script>
setTimeout(() => { document.getElementById("preloader").style.display = "none"; }, 1200);
</script>

<button id="toggleSidebar" onclick="toggleSidebar()">‚ò∞</button>

<!-- SIDEBAR (Login sudah dihapus) -->
<div class="sidebar hide" id="sidebar">
    <h2>Menu</h2>

    <a onclick="showDashboard()">üè† Dashboard</a>
    <a onclick="showCrud()">üìã Kelola Mahasiswa</a>
    <a onclick="logout()">üö™ Logout</a>
</div>

<!-- CONTENT -->
<div class="main collapsed" id="main">

<button id="modeToggle" onclick="toggleMode()">üåô Mode Gelap</button>

<!-- LOGIN -->
<div id="loginSection" class="container">
    <h3>Login</h3>
    <input id="username" type="text" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Masuk</button>
    <p id="loginError" style="color:red;"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">
    <h2>Dashboard</h2>

    <div class="dashboard">
        <div class="card">
            <h3>Total Mahasiswa</h3>
            <p id="totalMhs" style="font-size:28px;font-weight:bold;"></p>
        </div>
        <div class="card">
            <h3>IPK Tertinggi</h3>
            <p id="ipkMax" style="font-size:28px;font-weight:bold;"></p>
        </div>
        <div class="card">
            <h3>IPK Terendah</h3>
            <p id="ipkMin" style="font-size:28px;font-weight:bold;"></p>
        </div>
    </div>

    <h3>Grafik IPK Mahasiswa</h3>
    <canvas id="ipkChart" height="100"></canvas>
</div>

<!-- CRUD -->
<div id="crudSection" class="hidden">
    <h2>Kelola Mahasiswa</h2>

    <input id="nama" placeholder="Nama">
    <input id="nim" placeholder="NIM (12 ANGKA)" minlength="12">
    <input id="ipk" placeholder="IPK">

    <select id="jurusan">
        <option value="">Pilih Jurusan</option>
        <option>TEKNIK INFORMATIKA</option>
        <option>HUKUM</option>
        <option>TEKNIK MESIN</option>
        <option>SISTEM INFORMASI</option>
        <option>MANAJEMEN</option>
    </select>

    <button onclick="tambah()">Tambah</button>
    <button onclick="updateData()" id="btnUpdate" class="hidden">Simpan</button>

    <table>
        <thead>
            <tr>
                <th>Nama</th>
                <th>NIM</th>
                <th>Jurusan</th>
                <th>IPK</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody id="tabelData"></tbody>
    </table>

</div>
</div>

<script>
const sidebar = document.getElementById("sidebar");
const main = document.getElementById("main");

/* SIDEBAR FIX */
function toggleSidebar(){
    sidebar.classList.toggle("hide");

    if (sidebar.classList.contains("hide")){
        main.classList.add("collapsed");
    } else {
        main.classList.remove("collapsed");
    }
}

/* MODE */
function applyMode(){
    let mode = localStorage.getItem("mode") || "light";
    if(mode === "dark") document.body.classList.add("dark");
    else document.body.classList.remove("dark");
}
applyMode();

function toggleMode(){
    let mode = localStorage.getItem("mode") || "light";
    localStorage.setItem("mode", mode === "light" ? "dark" : "light");
    applyMode();
}

/* LOGIN SYSTEM */
let isLoggedIn = false;

localStorage.setItem("akun", JSON.stringify([
    { username: "Fazri", password: "241011402315" }
]));

function login(){
    let akun = JSON.parse(localStorage.getItem("akun"));
    let user = username.value.trim().toLowerCase();
    let pass = password.value.trim();

    let valid = akun.find(a => a.username.toLowerCase() === user && a.password === pass);

    if(valid){
        isLoggedIn = true;
        loginSection.classList.add("hidden");
        showDashboard();
    } else {
        loginError.textContent = "Login salah!";
    }
}

function logout(){
    isLoggedIn = false;
    showLogin();
}

function showLogin(){
    dashboard.classList.add("hidden");
    crudSection.classList.add("hidden");
    loginSection.classList.remove("hidden");
}

function showDashboard(){
    if(!isLoggedIn) return alert("Silakan login dulu!");
    dashboard.classList.remove("hidden");
    crudSection.classList.add("hidden");
    loginSection.classList.add("hidden");
    tampilStatistik();
    updateChart();
}

function showCrud(){
    if(!isLoggedIn) return alert("Silakan login dulu!");
    dashboard.classList.add("hidden");
    crudSection.classList.remove("hidden");
    loginSection.classList.add("hidden");
    muatData();
}

/* DATA */
let data = JSON.parse(localStorage.getItem("mahasiswa")) || [];
function simpan(){ localStorage.setItem("mahasiswa",JSON.stringify(data)); }

function tampilStatistik(){
    totalMhs.textContent = data.length;

    if(data.length > 0){
        ipkMax.textContent = Math.max(...data.map(m=>m.ipk));
        ipkMin.textContent = Math.min(...data.map(m=>m.ipk));
    } else {
        ipkMax.textContent = "-";
        ipkMin.textContent = "-";
    }
}

/* CRUD */
let indexEdit = -1;

function tambah(){

    if (nim.value.length < 12) return alert("NIM minimal 12 digit!");

    if (data.find(m => m.nim === nim.value)) return alert("NIM sudah terdaftar!");

    data.push({
        nama:nama.value,
        nim:nim.value,
        jurusan:jurusan.value,
        ipk:parseFloat(ipk.value)
    });
    simpan();
    muatData();
    tampilStatistik();
    updateChart();
}

function muatData(){
    tabelData.innerHTML = "";
    data.forEach((m,i)=>{
        tabelData.innerHTML += `
            <tr>
                <td>${m.nama}</td>
                <td>${m.nim}</td>
                <td>${m.jurusan}</td>
                <td>${m.ipk}</td>
                <td>
                    <button onclick="edit(${i})">Edit</button>
                    <button onclick="hapus(${i})">Hapus</button>
                </td>
            </tr>
        `;
    });
}

function hapus(i){
    data.splice(i,1);
    simpan();
    muatData();
    tampilStatistik();
    updateChart();
}

function edit(i){
    indexEdit = i;
    nama.value = data[i].nama;
    nim.value = data[i].nim;
    jurusan.value = data[i].jurusan;
    ipk.value = data[i].ipk;
    btnUpdate.classList.remove("hidden");
}

function updateData(){
    data[indexEdit] = {
        nama:nama.value,
        nim:nim.value,
        jurusan:jurusan.value,
        ipk:parseFloat(ipk.value)
    };
    simpan();
    muatData();
    tampilStatistik();
    updateChart();
    btnUpdate.classList.add("hidden");
}

/* CHART */
let chart = null;

function updateChart(){
    let ctx = document.getElementById("ipkChart").getContext("2d");

    let labels = data.map(m=>m.nama);
    let ipkData = data.map(m=>m.ipk);

    if(chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "IPK Mahasiswa",
                data: ipkData,
                backgroundColor: "rgba(75, 123, 255, 0.7)",
                borderColor: "rgba(75,123,255,1)",
                borderWidth: 2
            }]
        },
        options: {
            scales: { y: { beginAtZero:true } }
        }
    });
}
</script>

</body>
</html>
